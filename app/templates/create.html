{% extends 'base.html' %}
{% from "macro.html" import render_field_with_errors %}

{% block styles %}
    {{ super() }}

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.17/dist/css/bootstrap-select.min.css">

    <style>
        html,
        body,
        .post_content {
          height: auto;
          min-height: 100vh;
        }
        .navbar {
            background-color: #6f7782;
        }
        footer.page-footer {
            background-color: #6f7782;
        }
    </style>
{% endblock styles %}

{% block page_content %}
    <div class="row  mt-1 mb-1 pt-3 mx-4 post_content">
        <!-- Main List -->
        <div class="col-lg-12 col-12">
            <div class="card">
                <!-- Card content -->
                <form class="card-body" method="POST"
                      action="{% if post %}{{ url_for('posts.edit_post', post_slug=post.slug) }}{% else %}{{ url_for('posts.create_post') }}{% endif %}">
                    {{ form.csrf_token }}
                    <div class="row">
                      <!-- Grid column -->
                      <div class="col-md-9">
                          {{ render_field_with_errors(form.title, necessary=True) }}
                          {{ render_field_with_errors(form.abstract, necessary=True) }}
                          {{ render_field_with_errors(form.body, necessary=True) }}
                      </div>
                      <!-- Grid column -->

                      <!-- Grid column -->
                      <div class="col-md-3">
                          <div class="form-group">
                              {{ form.category.label }}
                              <span class="red-text">*</span>
                              <span data-toggle="modal" data-target="#create_category" style="display: inline-block;margin-left: 5px;vertical-align: top; margin-top: -5px;">
                                  <i class="fas fa-plus-circle" style="color: #3f51b5; font-size: 12px;"></i>
                              </span>
                              {{ form.category }}
                              {% if form.category.errors %}
                                  <ul>
                                  {% for error in form.category.errors %}
                                    <li>
                                        <small class="form-text text-muted mb-4">{{ error }}</small>
                                    </li>
                                  {% endfor %}
                                  </ul>
                              {% endif %}
                          </div>

                          <div class="form-group">
                              {{ form.relate.label }}
                              <span data-toggle="modal" data-target="#create_relate" style="display: inline-block;margin-left: 5px;vertical-align: top; margin-top: -5px;">
                                  <i class="fas fa-plus-circle" style="color: #3f51b5; font-size: 12px;"></i>
                              </span>
                              {{ form.relate }}
                              {% if form.relate.errors %}
                                  <ul>
                                  {% for error in form.relate.errors %}
                                    <li>
                                        <small class="form-text text-muted mb-4">{{ error }}</small>
                                    </li>
                                  {% endfor %}
                                  </ul>
                              {% endif %}
                          </div>

                          <div class="form-group">
                            {{ form.tags.label }}
                            <span class="red-text">*</span>
                            <span data-toggle="modal" data-target="#create_tag" style="display: inline-block;margin-left: 5px;vertical-align: top; margin-top: -5px;">
                                <i class="fas fa-plus-circle" style="color: #3f51b5; font-size: 12px;"></i>
                            </span>
                            {{ form.tags }}
                            {% if form.tags.errors %}
                                <ul>
                                  {% for error in form.tags.errors %}
                                    <li>
                                        <small class="form-text text-muted mb-4">{{ error }}</small>
                                    </li>
                                  {% endfor %}
                                </ul>
                            {% endif %}
                          </div>

                          <div class="form-group">
                              {{ form.deny_comment }}
                              {{ form.deny_comment.label }}
                          </div>
                      </div>
                      <!-- Grid column -->
                    </div>

                    <div class="btn-group">
                        <div class="form-group">
                            {{ form.publish_submit }}
                        </div>
                        <div class="form-group ml-1">
                            {{ form.save_submit }}
                        </div>
                    </div>
                </form>
                <div class="modal fade" style="z-index: 11112;" id="create_category" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog modal-full-height modal-right modal-notify modal-info">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h6 class="modal-title" id="exampleModalLabel">{{ _("Creat a new category") }}</h6>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form class="mt-3" method="POST" action="{{ url_for('posts.create_category') }}">
                                    {{ create_category_form.csrf_token }}
                                    {{ render_field_with_errors(create_category_form.name) }}

                                    <div style="position: fixed;right: 0;bottom: 0;">
                                        <button type="button" class="btn btn-secondary waves-effect waves-light" data-dismiss="modal">{{ _("Close") }}</button>
                                        <button type="submit" class="btn btn-primary waves-effect waves-light">{{ _("Save") }}</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" style="z-index: 11112;" id="create_tag" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog modal-full-height modal-right modal-notify modal-info">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h6 class="modal-title" id="exampleModalLabel">{{ _("Creat a new tag") }}</h6>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form class="mt-3" method="POST" action="{{ url_for('posts.create_tag') }}">
                                    {{ create_tag_form.csrf_token }}
                                    {{ render_field_with_errors(create_tag_form.name) }}

                                    <div style="position: fixed;right: 0;bottom: 0;">
                                        <button type="button" class="btn btn-secondary waves-effect waves-light" data-dismiss="modal">{{ _("Close") }}</button>
                                        <button type="submit" class="btn btn-primary waves-effect waves-light">{{ _("Save") }}</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" style="z-index: 11112;" id="create_relate" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog modal-full-height modal-right modal-notify modal-info">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h6 class="modal-title" id="exampleModalLabel">{{ _("Creat a new relate") }}</h6>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form class="mt-3" method="POST" action="{{ url_for('posts.create_relate') }}">
                                    {{ create_relate_form.csrf_token }}
                                    {{ render_field_with_errors(create_relate_form.name) }}

                                    <div style="position: fixed;right: 0;bottom: 0;">
                                        <button type="button" class="btn btn-secondary waves-effect waves-light" data-dismiss="modal">{{ _("Close") }}</button>
                                        <button type="submit" class="btn btn-primary waves-effect waves-light">{{ _("Save") }}</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Main List -->
    </div>
{% endblock page_content %}

{% block scripts %}
    {{ super() }}
    {{ ckeditor.load() }}
    {{ ckeditor.config(name='body') }}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.17/dist/js/bootstrap-select.min.js"></script>
{% endblock %}
